!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cm=t():e.cm=t()}(self,(()=>(()=>{"use strict";var e={482:(e,t,s)=>{function n(e){const t={};for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s];n.name.startsWith("data-")&&(t[n.name.slice(5)]=n.value)}return t}function i(e,t){const s=Object.keys(e);for(let n=0;n<s.length;n++){const i=s[n],o=e[i];t[i]!==o&&t.setAttribute("data-"+i,o)}}s.d(t,{RT:()=>n,X7:()=>i})}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};function i(){const e=document.cookie.split(";"),t=[],s=new RegExp("^\\s*([^=]+)\\s*=\\s*(.*?)$");for(let n=0;n<e.length;n++){const i=e[n],o=s.exec(i);null!==o&&t.push({name:o[1],value:o[2]})}return t}function o(e,t,s){let n=e+"=; Max-Age=-99999999;";document.cookie=n,n+=" path="+(t||"/")+";",document.cookie=n,void 0!==s&&(n+=" domain="+s+";",document.cookie=n)}s.r(n),s.d(n,{default:()=>f});var r=s(482);class c{constructor(e,t){this.key=e.storageName,this.handle=t}get(){return this.handle.getItem(this.key)}getWithKey(e){return this.handle.getItem(e)}set(e){return this.handle.setItem(this.key,e)}setWithKey(e,t){return this.handle.setItem(e,t)}delete(){return this.handle.removeItem(this.key)}deleteWithKey(e){return this.handle.removeItem(e)}}class a extends c{constructor(e){super(e,sessionStorage)}}const l={cookie:class{constructor(e){this.cookieName=e.storageName,this.cookieDomain=e.cookieDomain,this.cookiePath=e.cookiePath,this.cookieExpiresAfterDays=e.cookieExpiresAfterDays}get(){const e=function(e){const t=i();for(let s=0;s<t.length;s++)if(t[s].name===e)return t[s];return null}(this.cookieName);return e?e.value:null}set(e){return function(e,t,s,n,i){let o="";if(s){const e=new Date;e.setTime(e.getTime()+24*s*60*60*1e3),o="; expires="+e.toUTCString()}void 0!==n&&(o+="; domain="+n),o+=void 0!==i?"; path="+i:"; path=/",document.cookie=e+"="+(t||"")+o+"; SameSite=Lax"}(this.cookieName,e,this.cookieExpiresAfterDays,this.cookieDomain,this.cookiePath)}delete(){return o(this.cookieName)}},test:class{constructor(){this.value=null}get(){return this.value}set(e){this.value=e}delete(){this.value=null}},localStorage:class extends c{constructor(e){super(e,localStorage)}},sessionStorage:a};function h(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?h(Object(s),!0).forEach((function(t){u(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):h(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function u(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class f{constructor(e,t,s){this.config=e,this.store=void 0!==t?t:new l[this.storageMethod](this),void 0===this.store&&(this.store=l.cookie),this.auxiliaryStore=void 0!==s?s:new a(this),this.consents=this.defaultConsents,this.confirmed=!1,this.changed=!1,this.states={},this.initialized={},this.executedOnce={},this.watchers=new Set([]),this.loadConsents(),this.applyConsents(),this.savedConsents=d({},this.consents)}get storageMethod(){return this.config.storageMethod||"cookie"}get storageName(){return this.config.storageName||this.config.cookieName||"klaro"}get cookieDomain(){return this.config.cookieDomain||void 0}get cookiePath(){return this.config.cookiePath||void 0}get cookieExpiresAfterDays(){return this.config.cookieExpiresAfterDays||120}get defaultConsents(){const e={};for(let t=0;t<this.config.services.length;t++){const s=this.config.services[t];e[s.name]=this.getDefaultConsent(s)}return e}watch(e){this.watchers.has(e)||this.watchers.add(e)}unwatch(e){this.watchers.has(e)&&this.watchers.delete(e)}notify(e,t){this.watchers.forEach((s=>{s.update(this,e,t)}))}getService(e){const t=this.config.services.filter((t=>t.name===e));if(t.length>0)return t[0]}getDefaultConsent(e){let t=e.default||e.required;return void 0===t&&(t=this.config.default),void 0===t&&(t=!1),t}changeAll(e){let t=0;return this.config.services.filter((e=>!e.contextualConsentOnly)).map((s=>{s.required||this.config.required||e?this.updateConsent(s.name,!0)&&t++:this.updateConsent(s.name,!1)&&t++})),t}updateConsent(e,t){const s=(this.consents[e]||!1)!==t;return this.consents[e]=t,this.notify("consents",this.consents),s}resetConsents(){this.consents=this.defaultConsents,this.states={},this.confirmed=!1,this.applyConsents(),this.savedConsents=d({},this.consents),this.store.delete(),this.notify("consents",this.consents)}getConsent(e){return this.consents[e]||!1}loadConsents(){const e=this.store.get();return null!==e&&(this.consents=JSON.parse(decodeURIComponent(e)),this._checkConsents(),this.notify("consents",this.consents)),this.consents}saveAndApplyConsents(e){this.saveConsents(e),this.applyConsents()}changedConsents(){const e={};for(const[t,s]of Object.entries(this.consents))this.savedConsents[t]!==s&&(e[t]=s);return e}saveConsents(e){const t=encodeURIComponent(JSON.stringify(this.consents));this.store.set(t),this.confirmed=!0,this.changed=!1;const s=this.changedConsents();this.savedConsents=d({},this.consents),this.notify("saveConsents",{changes:s,consents:this.consents,type:e||"script"})}applyConsents(e,t,s){function n(e,t){if(void 0===e)return;let s;return s="function"==typeof e?e:new Function("opts",e),s(t)}let i=0;for(let e=0;e<this.config.services.length;e++){const t=this.config.services[e];if(void 0!==s&&s!==t.name)continue;const i=t.vars||{},o={service:t,config:this.config,vars:i};this.initialized[t.name]||(this.initialized[t.name]=!0,n(t.onInit,o))}for(let o=0;o<this.config.services.length;o++){const r=this.config.services[o];if(void 0!==s&&s!==r.name)continue;const c=this.states[r.name],a=r.vars||{},l=void 0!==r.optOut?r.optOut:this.config.optOut||!1,h=void 0!==r.required?r.required:this.config.required||!1,d=this.confirmed||l||e||t,u=this.getConsent(r.name)&&d||h,f={service:r,config:this.config,vars:a,consents:this.consents,confirmed:this.confirmed};c!==u&&i++,e||(n(u?r.onAccept:r.onDecline,f),this.updateServiceElements(r,u),this.updateServiceStorage(r,u),void 0!==r.callback&&r.callback(u,r),void 0!==this.config.callback&&this.config.callback(u,r),this.states[r.name]=u)}return this.notify("applyConsents",i,s),i}updateServiceElements(e,t){if(t){if(e.onlyOnce&&this.executedOnce[e.name])return;this.executedOnce[e.name]=!0}const s=document.querySelectorAll("[data-name='"+e.name+"']");for(let n=0;n<s.length;n++){const i=s[n],o=i.parentElement,c=(0,r.RT)(i),{type:a,src:l,href:h}=c,d=["href","src","type"];if("placeholder"!==a)if("IFRAME"===i.tagName){if(t&&i.src===l){console.debug(`Skipping ${i.tagName} for service ${e.name}, as it already has the correct type...`);continue}const s=document.createElement(i.tagName);for(const e of i.attributes)if("style"===e.name){const[t,n]=e.value.split(":");s.style[t.trim()]=n.trim()}else s.setAttribute(e.name,e.value);s.innerText=i.innerText,s.text=i.text,t?(void 0!==c["original-display"]&&(s.style.display=c["original-display"]),void 0!==c.src&&(s.src=c.src)):(s.src="",void 0!==c["modified-by-klaro"]&&void 0!==c["original-display"]?s.setAttribute("data-original-display",c["original-display"]):(void 0!==i.style.display&&s.setAttribute("data-original-display",i.style.display),s.setAttribute("data-modified-by-klaro","yes")),s.style.display="none"),o.insertBefore(s,i),o.removeChild(i)}else if("SCRIPT"===i.tagName||"LINK"===i.tagName){if(t&&i.type===(a||"")&&i.src===l){console.debug(`Skipping ${i.tagName} for service ${e.name}, as it already has the correct type or src...`);continue}const s=document.createElement(i.tagName);for(const e of i.attributes)s.setAttribute(e.name,e.value);i.hasAttribute("nonce")&&s.setAttribute("nonce",i.nonce),s.innerText=i.innerText,s.text=i.text,t?(s.type=a||"",void 0!==l&&(s.src=l),void 0!==h&&(s.href=h)):s.type="text/plain",o.insertBefore(s,i),o.removeChild(i)}else{if(t){for(const e of d){const t=c[e];void 0!==t&&(void 0===c["original-"+e]&&(c["original-"+e]=i[e]),i[e]=t)}void 0!==c.title&&(i.title=c.title),void 0!==c["original-display"]?i.style.display=c["original-display"]:i.style.removeProperty("display")}else{void 0!==c.title&&i.removeAttribute("title"),void 0===c["original-display"]&&void 0!==i.style.display&&(c["original-display"]=i.style.display),i.style.display="none";for(const e of d)void 0!==c[e]&&(void 0!==c["original-"+e]?i[e]=c["original-"+e]:i.removeAttribute(e))}(0,r.X7)(c,i)}else t?(i.style.display="none",c["original-display"]=i.style.display):i.style.display=c["original-display"]||"block"}}updateServiceStorage(e,t){if(!t&&void 0!==e.cookies&&e.cookies.length>0){const t=i();for(let s=0;s<e.cookies.length;s++){let n,i,r=e.cookies[s];if(r instanceof Array)[r,n,i]=r;else if(r instanceof Object&&!(r instanceof RegExp)){const e=r;r=e.pattern,n=e.path,i=e.domain}if(void 0!==r){r instanceof RegExp||(r=r.startsWith("^")?new RegExp(r):new RegExp("^"+r.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")+"$"));for(let e=0;e<t.length;e++){const s=t[e];null!==r.exec(s.name)&&(console.debug("Deleting cookie:",s.name,"Matched pattern:",r,"Path:",n,"Domain:",i),o(s.name,n,i),void 0===i&&o(s.name,n,"."+window.location.hostname))}}}}}_checkConsents(){let e=!0;const t=new Set(this.config.services.map((e=>e.name))),s=new Set(Object.keys(this.consents));for(const e of Object.keys(this.consents))t.has(e)||delete this.consents[e];for(const t of this.config.services)s.has(t.name)||(this.consents[t.name]=this.getDefaultConsent(t),e=!1);this.confirmed=e,e||(this.changed=!0)}}return n})()));